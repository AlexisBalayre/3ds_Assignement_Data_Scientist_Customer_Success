flowchart TD
    A[Vector Index Query] --> B[Filter Closed Tickets]
    B --> C[Find Solution Comments]
    C --> D[Get Solution Author]
    D --> E[Find Context Comments]
    E --> F[Get Context Authors]
    F --> G[Collect & Order Data]
    G --> H[Return Sorted Results]
    
    %% Add details
    A1[db.index.vector.queryNodes<br/>→ tickets + similarity scores]
    B1[WHERE status.isClosed = true<br/>AND score ≥ threshold]
    C1[WHERE isSolution = true]
    D1[User → POSTS → Comment]
    E1[Comments before solution<br/>ORDER BY date DESC]
    F1[User → POSTS → Context Comments]
    G1[Build result objects<br/>with all metadata]
    H1[ORDER BY similarity DESC]
    
    A -.-> A1
    B -.-> B1
    C -.-> C1
    D -.-> D1
    E -.-> E1
    F -.-> F1
    G -.-> G1
    H -.-> H1
    
    %% Styling
    classDef main fill:#e3f2fd,stroke:#1976d2,stroke-width:2px
    classDef detail fill:#f5f5f5,stroke:#666,stroke-width:1px,stroke-dasharray: 3 3
    
    class A,B,C,D,E,F,G,H main
    class A1,B1,C1,D1,E1,F1,G1,H1 detail